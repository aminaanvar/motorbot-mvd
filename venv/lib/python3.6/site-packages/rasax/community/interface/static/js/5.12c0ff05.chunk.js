(this["webpackJsonprasa-frontend"]=this["webpackJsonprasa-frontend"]||[]).push([[5],{1895:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return P}));var n=r(0),c=r(1),s=r(72),o=r(2),a=r(18),l=r(24),i=r(68),u=r(45),j=r(3),d=r(97),b=r(61),h=r(4),f=r(9),x=r(31),O=r(201),v=r(25);function m(e){var t=e.roles,r=e.users,s=e.total,o=e.onLoadMoreRows,a=e.onEdit,l=e.onDelete,i=c.useCallback((function(e){var t=e.dataSelected,r=e.setSelected,c=t.filter((function(e){return e.users_count&&e.users_count>0})).length;return Object(n.jsx)(h.Box,{children:Object(n.jsx)(x.a,{resource:f.d.Roles,action:f.a.Delete,yes:Object(n.jsx)(v.a,{content:c>0?"Cannot perform delete because ".concat(1===c?"the selected role still has":"".concat(c," selected roles still have")," users assigned"):"Delete",children:Object(n.jsx)(j.d,{variant:"inverse",disabled:c>0,onClick:function(){l(t),r([])},children:"Delete"})})})})}),[l]),u=c.useCallback((function(e){var t=e.selected,r=e.onChangeSelected;return function(e){var c=e.rowIndex,s=e.rowData,o=t.includes(c);return Object(n.jsxs)(h.Flex,{children:[Object(n.jsx)(h.Box,{flex:"0 1 auto",children:Object(n.jsx)("label",{children:Object(n.jsx)(j.f,{checked:o,onChange:function(){return r(c,!o)}})})}),Object(n.jsx)(h.Box,{ml:3,flex:"1",children:Object(n.jsx)(j.y,{variant:"bodySecondary",children:s.role})})]})}}),[]),d=c.useCallback((function(){return function(e){var t=e.rowData,c=Object.values(r).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return 0===c.length?Object(n.jsx)(j.y,{variant:"bodySecondary",children:"No users currently have this role"}):c.length<3?Object(n.jsx)(j.y,{variant:"bodySecondary",children:c.map((function(e){return e.username})).join(" and ")}):Object(n.jsxs)(j.y,{variant:"bodySecondary",children:[c.slice(0,2).map((function(e){return e.username})).join(", "),Object(n.jsxs)("b",{children:[" +",c.length-2," more"]})]})}}),[r]),m=c.useCallback((function(){return function(e){var t=e.rowData;if(!t)return null;var c=Object.values(r).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return Object(n.jsxs)(h.Flex,{flexDirection:"row-reverse",mr:-1,children:[Object(n.jsx)(x.a,{resource:f.d.Roles,action:f.a.Delete,yes:0===c.length?Object(n.jsx)(v.a,{content:"Delete",children:Object(n.jsx)(j.d,{mx:1,onClick:function(){l([t])},variant:"icon",children:Object(n.jsx)(j.j,{icon:"trash-alt"})})}):Object(n.jsx)(h.Box,{mx:1,flex:"0 0 40px"})}),Object(n.jsx)(x.a,{resource:f.d.Roles,action:f.a.Update,yes:Object(n.jsx)(v.a,{content:"Edit",children:Object(n.jsx)(j.d,{mx:1,onClick:function(){a(t)},variant:"icon",children:Object(n.jsx)(j.j,{icon:"edit"})})})})]})}}),[r,a,l]);return Object(n.jsx)(O.a,{total:s,bulkActionsRenderer:i,data:t,resource:f.d.Roles,onLoadMoreRows:o,children:function(e){return[Object(n.jsx)(b.d,{cellDataGetter:function(){},flexGrow:2,width:2/6,dataKey:"role",label:"Role",cellRenderer:u(e)},"role"),Object(n.jsx)(b.d,{cellDataGetter:function(){},flexGrow:3,width:2/6,dataKey:"role",label:"Description",cellRenderer:function(e){var t=e.rowData;return Object(n.jsx)(j.y,{variant:"bodySecondary",children:t.description||"No description"})}},"description"),Object(n.jsx)(b.d,{cellDataGetter:function(){},flexGrow:3,width:1/6,dataKey:"role",label:"Users",cellRenderer:d()},"users"),Object(n.jsx)(b.d,{cellDataGetter:function(){},flexGrow:1,width:1/6,dataKey:"role",label:"",cellRenderer:m()},"role")]}})}function p(e){var t=e.roles,r=e.users,o=e.total,a=e.onLoadMoreRows,l=e.onFetchUsers,i=e.onDeleteRole,u=Object(s.g)().push,b=c.useCallback((function(e){return u("/roles/".concat(e.role))}),[u]);return c.useEffect((function(){a({search:"",offset:0,limit:0}),l({search:"",offset:0,limit:0})}),[a,l]),Object(n.jsx)(d.a,{title:"Roles",rightContent:Object(n.jsx)(j.d,{variant:"primary",large:!0,onClick:function(){return u("/roles/create")},mr:4,children:"Create new role"}),children:Object(n.jsx)(m,{roles:t,users:r,total:o,onLoadMoreRows:a,onEdit:b,onDelete:i})})}var y={onFetchUsers:u.c.request,onFetchRoles:i.d.request,onDeleteRole:i.a.request};var w=Object(a.b)((function(e){return{roles:e.roles.roles,users:e.users.users,total:e.roles.total,userRole:e.auth.role}}),y)((function(e){var t=Object(l.i)(i.d);return Object(n.jsx)(p,Object(o.a)(Object(o.a)({},e),{},{onLoadMoreRows:t}))})),g=r(23),C=r(8),R=r(641),D=r(415);function k(e){return Object(n.jsx)(j.d,Object(o.a)(Object(o.a)({variant:"icon",color:"neutral_8"},e),{},{children:Object(n.jsx)(j.j,{icon:["fas","arrow-left"]})}))}var F,S=r(76),U=r(15);function B(e,t){return[].concat(Object(U.a)(e?["read:any"]:[]),Object(U.a)(t?["create:any","update:any","delete:any"]:[]))}function E(e){var t=e.value,r=e.permission,c=e.onChange,s=t.includes("read:any"),o=t.includes("create:any");return Object(n.jsxs)(h.Flex,{py:3,children:[Object(n.jsx)(h.Box,{flex:4,width:4/6,children:Object(n.jsx)(j.y,{children:r.label})}),Object(n.jsx)(h.Box,{flex:1,width:1/6,children:!r.cannotView&&Object(n.jsx)("label",{children:Object(n.jsx)(j.f,{checked:s,onChange:function(){return c(B(!s,o))}})})}),Object(n.jsx)(h.Box,{flex:1,width:1/6,children:!r.cannotModify&&Object(n.jsx)("label",{children:Object(n.jsx)(j.f,{checked:o,onChange:function(){return c(B(s,!o))}})})})]})}function q(e){var t=e.value,r=e.onChange,c=e.permissions;return Object(n.jsxs)(h.Box,{children:[Object(n.jsxs)(h.Flex,{py:3,children:[Object(n.jsx)(h.Box,{flex:4,width:4/6,children:Object(n.jsx)(j.i,{variant:"h3",children:"Permissions"})}),Object(n.jsx)(h.Box,{flex:1,width:1/6,children:Object(n.jsx)(j.i,{variant:"h3",children:"View"})}),Object(n.jsx)(h.Box,{flex:1,width:1/6,children:Object(n.jsx)(j.i,{variant:"h3",children:"Modify"})})]}),c.map((function(e){return Object(n.jsx)(E,{permission:e,value:t[e.resource]||[],onChange:function(n){return r(Object(o.a)(Object(o.a)({},t),{},{[e.resource]:n}))}},e.resource)}))]})}!function(e){e[e.Permissions=0]="Permissions",e[e.Users=1]="Users"}(F||(F={}));var M={role:"",description:"",is_default:!1,grants:{}};function _(e){var t=e.users,r=e.role,a=e.onSaveRole,l=e.onUpdateRole,i=e.onFetchUsers,u=e.permissions,b=Object(s.g)().push,f=c.useState(r||M),x=Object(C.a)(f,2),O=x[0],v=x[1],m=c.useState([]),p=Object(C.a)(m,2),y=p[0],w=p[1],g=c.useState(F.Users),U=Object(C.a)(g,2),B=U[0],E=U[1],_=c.useCallback((function(e){return v(Object(o.a)(Object(o.a)({},O),e))}),[O]);c.useEffect((function(){i({search:"",limit:0,offset:0})}),[i]),c.useEffect((function(){r&&v(r)}),[r]),c.useEffect((function(){w(Object.values(t).filter((function(e){return r&&-1!==e.roles.indexOf(r.role)})).map((function(e){return{label:e.username,value:e.username,data:e}})))}),[r,t,t.length]);var G=c.useMemo((function(){return Object.values(t).map((function(e){return{label:e.username,value:e.username,data:e}}))}),[t]);return Object(n.jsx)(d.a,{scrollable:!0,title:Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(k,{onClick:function(){return b("/roles")}})," ",r?"Edit":"Create new"," ","Role"]}),rightContent:Object(n.jsxs)(h.Flex,{mr:-2,pr:4,flexDirection:"row-reverse",children:[Object(n.jsxs)(j.d,{variant:"primary",onClick:function(){var e=y.map((function(e){return e.data})),t=function(){b("/roles")},n=Object(o.a)(Object(o.a)({},O),{},{is_default:!!O.is_default});r?l({currentId:r.role,role:n,users:e,onSaved:t}):a({role:n,users:e,onSaved:t})},large:!0,mr:2,children:[r?"Save":"Create"," role"]}),Object(n.jsx)(j.d,{variant:"secondary",onClick:function(){return b("/roles")},large:!0,mr:2,children:r?"Cancel":"Discard"})]}),children:Object(n.jsxs)(h.Box,{width:2/3,m:"0 auto",children:[Object(n.jsxs)(j.e,{sx:{borderRadius:"large"},p:6,mb:6,children:[Object(n.jsx)(j.i,{variant:"h2",mb:4,children:"Basic Details"}),Object(n.jsx)(h.Box,{mb:4,width:"100%",children:Object(n.jsx)(S.a,{text:"Name",children:Object(n.jsx)(j.l,{value:O.role,onChangeValue:function(e){return _({role:e})},fullWidth:!0,placeholder:"Role title",autoFocus:!0})})}),Object(n.jsx)(h.Box,{mb:4,width:"100%",children:Object(n.jsx)(S.a,{text:"Description",children:Object(n.jsx)(j.l,{value:O.description||"",onChangeValue:function(e){return _({description:e})},fullWidth:!0,placeholder:"Access chat logs, analyze and define requirements for updates"})})}),Object(n.jsxs)(h.Flex,{as:"label",alignItems:"center",children:[Object(n.jsx)(j.f,{checked:O.is_default||!1,onChange:function(e){return _({is_default:!O.is_default})},mr:2}),Object(n.jsx)(j.y,{children:"Set as default roles"})]})]}),Object(n.jsxs)(j.e,{sx:{borderRadius:"large"},p:6,children:[Object(n.jsxs)(R.a,{justifyContent:"flex-start",ml:-3,mb:4,children:[Object(n.jsx)(D.a,{variant:"h2",active:B===F.Permissions,onClick:function(){return E(F.Permissions)},children:"Add Permissions"}),Object(n.jsx)(D.a,{variant:"h2",active:B===F.Users,onClick:function(){return E(F.Users)},children:"Add Users"})]}),B===F.Permissions&&Object(n.jsx)(q,{permissions:u,value:O.grants,onChange:function(e){return _({grants:e})}}),B===F.Users&&Object(n.jsx)(S.a,{text:"Add users to this Role",children:Object(n.jsx)(j.p,{placeholder:"Search users...",items:G,onChange:function(e){w(Array.isArray(e)?e:[])},value:y})})]})]})})}var G={onSaveRole:i.f.request,onUpdateRole:i.g.request,onFetchUsers:u.c.request,onFetchRole:i.b.request,onFetchRoleUsers:i.c.request};var A=Object(a.b)((function(e){return{users:e.users.users,permissions:e.roles.permissions,roles:e.roles.roles}}),G)((function(e){var t=e.roles,r=e.onFetchRoleUsers,a=e.onFetchRole,l=Object(g.a)(e,["roles","onFetchRoleUsers","onFetchRole"]),i=Object(s.i)().params.roleName;c.useEffect((function(){i&&(a(i),r(i))}),[a,r,i]);var u=c.useMemo((function(){if(i)return Object.values(t).find((function(e){return e.role===i}))}),[i,t]);return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)(_,Object(o.a)({role:u},l))})}));function P(e){var t=Object(l.l)();c.useEffect((function(){t("view:roles:loaded")}),[t]);var r=Object(s.i)();return Object(n.jsxs)(s.e,{children:[Object(n.jsx)(s.c,{exact:!0,path:r.path,component:w}),Object(n.jsx)(s.c,{exact:!0,path:"".concat(r.path,"/create"),component:A}),Object(n.jsx)(s.c,{exact:!0,path:"".concat(r.path,"/:roleName"),component:A})]})}}}]);